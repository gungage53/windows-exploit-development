#include <stdio.h>

//バッファーオーバーフローによって上書きされないよう、グローバル変数で保持
unsigned char* heap;
int size;
int i;

void printHexDump(){
	unsigned char buf[500];
	
	printf("buf = %p\n",&buf);
	printf("ファイルサイズ = %dByte\n",size);
	
	memcpy(buf, heap, size);
	for(i = 0; i < size; i++){
		if(i % 10 == 0 && i > 0) printf("\n");
		printf("%02x", buf[i]);
		printf(" ");
	}
	printf("\n");
	
	//__asm int 3;
	return;
}

int main(int argc, char ** argv)
{	
	char buf[1000]; //メイン関数より下のスタックを上書きすると、上書き時点で例外発生するため、空バッファで埋める
	FILE *fp;
	
	//file open
	fp = fopen(argv[1],"rb");
	
	//file size
	fseek(fp, 0, SEEK_END);
	size = ftell(fp);
	fseek(fp, 0, SEEK_SET);
	
	//file read
	heap = (unsigned char*)malloc(sizeof(unsigned char) * size);
	fread(heap,size,sizeof(unsigned char),fp);
	
	//file close
	fclose(fp);
	
	//__asm int 3;
	
	//print Hex Dump
	printHexDump();
	
	printf("出力完了\n");
	
	return 0;
}
