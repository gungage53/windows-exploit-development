#!/usr/bin/python2 -V
# coding: Shift_JIS
import sys
import pykd

class MyBpObject():
	def __init__(self, isOneShot):
		self.bp_obj = None
		self.isOneShot = isOneShot
		
	def callBack(self):
		print("callBack:{0}".format(self))
		if self.isOneShot == True:
			self.bp_obj.remove()
		return False
		
	def setBreakPoint(self, addr):
		#ì‡ïîÇ≈ï€éùÇµÇƒÇ®Ç©Ç»Ç¢Ç∆ÅAè¡Ç≥ÇÍÇÈÅB
		self.bp_obj = pykd.setBp(int(addr), self.callBack)
		
		return


print("onceBreakPoint.py")
str = pykd.dbgCommand("x CheckPass2!printf")
print(str)
ary = str.split("\n")
count = 0
list = []

for i  in range(0, len(ary) - 1):
	d = ary[i].split(" ")
	if d[0] != "" :
		myBp = MyBpObject(False)
		myBp.setBreakPoint(int(d[0], 16))
		list.append(myBp)
		
print("set breakpoint Num={0}".format(pykd.getNumberBreakpoints()))

pykd.go()
